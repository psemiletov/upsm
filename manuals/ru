#upsm
https://github.com/psemiletov/upsm

   РУКОВОДСТВО

   upsm это основанный на Qt монитор ИБП (фронт-энд к утилите upsc из состава Network UPS Tools). Он сидит в области уведомлений и запрашивает показания напряжения от nut-сервера используя upsc, поэтому вам нужно сначала настроить NUT, о чем я поведаю чуть ниже.
   В Настройках upsm нужно задать команду вызова upsc, например "upsc myups", и периодичность опроса сервера, в миллисекундах.
   Кнопка "закрыть" программы завершает работу программы, а кнопка "свернуть" - сворачивает в область уведомлений.
   Перейдем теперь к насущному вопросу.

   Как настроить NUT-сервер?

1. Даем команду lsusb, смотрим vendor id производителя УПС, например:

Bus 003 Device 004: ID 0d9f:0004 Powercom Co., Ltd
vendor id здесь = 0d9f
а шина = 003

2. Из /lib/udev/rules.d копируем файл с "именем число-nut-usbups.rules" в каталог /etc/udev/rules.d, если такового файла там еще нет.

3. Правим файл /etc/ups/ups.conf, добавляя в конец примерно такое:
[myups]
    driver = usbhid-ups
    port = auto
    desc = "My ups"
    vendorid = 0d9f
    pollfreq = 30

В vendorid прописываем полученный из lsusb вендор ид. pollfreq = частота опроса устройства, в секундах. Можно написать еще bus, где указать полученный номер шины, однако в Linux номера шины иногда меняются после перезагрузки.

4. До принятия Линуксами штуки под названием systemd, запуск NUT-сервера зафуговывали в какой-то скрипт автозапуска, а именно, вначале запускали драйвер:
upsdrvctl start
Потом сам сервер:
upsd

   А нонича всё инаково! Если вы установили NUT из исходника, а не из пакета (пакет сам все файлы куда надо раскидает), скопируйте вручную файлы, относящиеся к systemd, из исходника nut. Они лежат в подкаталоге /scripts/systemd, а "они" это nut-driver.service, nut-monitor.service, nut-server.service.
   Копируем их в /etc/systemd/system. 
   Далее, в раздел [Unit] файла nut-server.service добавляем строки 

Restart=on-failure
RestartSec=360s 

   Это чтобы если nut при запуске сразу не раздуплится с ИБП, то сделал это чуть позже.

 5. Теперь, чтобы nut запускался автоматически каждый раз при загрузке, даем под рутом команду 

   systemctl enable nut-server 

  И команду

   systemctl start nut-server 

  ...чтобы запустить сервер сейчас.

6. Пробуем прочитать данные с ИБП:

upsc myups
или, обычно при установке из исходника:
/usr/local/ups/bin/upsc myups@localhost

7. Прописываем эту строку в качестве команды опроса в Настройках upsm.

8. Если upsc выдает "Driver not connected", надо всё же запустить драйвер вручную:

upsdrvctl start

Можно также: 

upsdrvsvcctl resync
и потом запускать upsdrvsvcctl start
и останавливать upsdrvsvcctl stop


Петр Семилетов <peter.semiletov@gmail.com>

